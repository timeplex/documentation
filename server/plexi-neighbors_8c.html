<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>plexi: /home/gexarchakos/projects/contiki-public/apps/plexi/plexi-neighbors.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">plexi
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">/home/gexarchakos/projects/contiki-public/apps/plexi/plexi-neighbors.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Neighbor list resource provides access to the list of nodes in range.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="plexi-conf_8h_source.html">plexi-conf.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="plexi-interface_8h_source.html">plexi-interface.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="plexi-neighbors_8h_source.html">plexi-neighbors.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="plexi_8h_source.html">plexi.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="plexi-link-statistics_8h_source.html">plexi-link-statistics.h</a>&quot;</code><br/>
<code>#include &quot;er-coap-engine.h&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structaggregate__stats__struct.html">aggregate_stats_struct</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae6b65a94141537f5ec3cec4efedc6710"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="plexi-neighbors_8c.html#ae6b65a94141537f5ec3cec4efedc6710">plexi_neighbors_event_handler</a> (void)</td></tr>
<tr class="memdesc:ae6b65a94141537f5ec3cec4efedc6710"><td class="mdescLeft">&#160;</td><td class="mdescRight">Notifies subscribers to neighbor list of any changes in the neighbor list.  <a href="#ae6b65a94141537f5ec3cec4efedc6710">More...</a><br/></td></tr>
<tr class="separator:ae6b65a94141537f5ec3cec4efedc6710"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabee038a9ed6f8a665aa76463fe9674d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="plexi-neighbors_8c.html#aabee038a9ed6f8a665aa76463fe9674d">plexi_get_neighbors_handler</a> (void *request, void *response, uint8_t *buffer, uint16_t preferred_size, int32_t *offset)</td></tr>
<tr class="memdesc:aabee038a9ed6f8a665aa76463fe9674d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the list of neighbors upon a CoAP GET request to neighbor list resource.  <a href="#aabee038a9ed6f8a665aa76463fe9674d">More...</a><br/></td></tr>
<tr class="separator:aabee038a9ed6f8a665aa76463fe9674d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fd35e5dd4046a373e55bc53c6b6d241"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="plexi-neighbors_8c.html#a0fd35e5dd4046a373e55bc53c6b6d241">aggregate_statistics</a> (uint16_t id, uint8_t metric, plexi_stats_value_st value)</td></tr>
<tr class="memdesc:a0fd35e5dd4046a373e55bc53c6b6d241"><td class="mdescLeft">&#160;</td><td class="mdescRight">Aggregates statistics metric values per link for each neighbor.  <a href="#a0fd35e5dd4046a373e55bc53c6b6d241">More...</a><br/></td></tr>
<tr class="separator:a0fd35e5dd4046a373e55bc53c6b6d241"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1c9748facc2b23c010bad9d018e74b7"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="plexi-neighbors_8c.html#ad1c9748facc2b23c010bad9d018e74b7">PARENT_PERIODIC_RESOURCE</a> (resource_6top_nbrs,&quot;obs;title=\&quot;6top neighbours\&quot;&quot;, plexi_get_neighbors_handler, NULL, NULL, NULL, PLEXI_NEIGHBOR_UPDATE_INTERVAL, plexi_neighbors_event_handler)</td></tr>
<tr class="memdesc:ad1c9748facc2b23c010bad9d018e74b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Neighbor List resource to GET and OBSERVE list of neighbors. Subscribers to this resource are notified of changes and periodically.  <a href="#ad1c9748facc2b23c010bad9d018e74b7">More...</a><br/></td></tr>
<tr class="separator:ad1c9748facc2b23c010bad9d018e74b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2cfb7200ae45f0f4df08118854d603a3"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2cfb7200ae45f0f4df08118854d603a3"></a>
static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="plexi-neighbors_8c.html#a2cfb7200ae45f0f4df08118854d603a3">plexi_neighbors_changed_handler</a> (void *ptr)</td></tr>
<tr class="memdesc:a2cfb7200ae45f0f4df08118854d603a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Notifies all clients who observe changes to the neighbor list resource. <br/></td></tr>
<tr class="separator:a2cfb7200ae45f0f4df08118854d603a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e4c102e8532799c7a9e9c34c745c502"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="plexi-neighbors_8c.html#a7e4c102e8532799c7a9e9c34c745c502">route_changed_callback</a> (int event, uip_ipaddr_t *route, uip_ipaddr_t *ipaddr, int num_routes)</td></tr>
<tr class="memdesc:a7e4c102e8532799c7a9e9c34c745c502"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function to be called when a change to the DAG_RESOURCE resource has occurred. Any change is delayed 30seconds before it is propagated to the observers.  <a href="#a7e4c102e8532799c7a9e9c34c745c502">More...</a><br/></td></tr>
<tr class="separator:a7e4c102e8532799c7a9e9c34c745c502"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c25592b86fa9e457f00d0fc05dfd823"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="plexi-neighbors_8c.html#a9c25592b86fa9e457f00d0fc05dfd823">plexi_neighbors_init</a> ()</td></tr>
<tr class="memdesc:a9c25592b86fa9e457f00d0fc05dfd823"><td class="mdescLeft">&#160;</td><td class="mdescRight">Landing initialization function of plexi-neighbors module. Call from <a class="el" href="plexi_8h.html#a146916d944fd1adb5c0621bbf4ded47b">plexi_init</a> to start plexi-neighbors module.  <a href="#a9c25592b86fa9e457f00d0fc05dfd823">More...</a><br/></td></tr>
<tr class="separator:a9c25592b86fa9e457f00d0fc05dfd823"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a261a160bd3be8f85d6d73d664de14656"><td class="memItemLeft" align="right" valign="top">static struct <br class="typebreak"/>
<a class="el" href="structaggregate__stats__struct.html">aggregate_stats_struct</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="plexi-neighbors_8c.html#a261a160bd3be8f85d6d73d664de14656">temp_aggregate_stats</a> = { .rssi = (int)0xFFFFFFFFFFFFFFFF, .lqi = -1, .etx = -1, .pdr = -1, .asn = -1, .rssi_counter = 0, .lqi_counter = 0, .asn_counter = 0, .etx_counter = 0, .pdr_counter = 0 }</td></tr>
<tr class="memdesc:a261a160bd3be8f85d6d73d664de14656"><td class="mdescLeft">&#160;</td><td class="mdescRight">Α module-scope temporary structure to keep track of help the aggregation of the link-oriented statistics into neighbor-wide statistics.  <a href="#a261a160bd3be8f85d6d73d664de14656">More...</a><br/></td></tr>
<tr class="separator:a261a160bd3be8f85d6d73d664de14656"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8cb18c43d06ecd3335a13b3816244b5"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad8cb18c43d06ecd3335a13b3816244b5"></a>
static struct ctimer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="plexi-neighbors_8c.html#ad8cb18c43d06ecd3335a13b3816244b5">route_changed_timer</a></td></tr>
<tr class="memdesc:ad8cb18c43d06ecd3335a13b3816244b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for 30s without activity before notifying subscribers. <br/></td></tr>
<tr class="separator:ad8cb18c43d06ecd3335a13b3816244b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Neighbor list resource provides access to the list of nodes in range. </p>
<p>PLEXI RPL DoDAG resource interface (implementation file)</p>
<p>This resource refers to the MAC-layer neighbors. This list might not be equivalent to TSCH-layer neighbors. That is, it might contain nodes that is not scheduled to communicate with. Vice versa, the schedule might contain links to neighbors that are not momentarily or ever reachable.</p>
<p>However, even if the node is not scheduled to communicate with certain neighbor, the negihbor has to be able to send EBs and the node to receive them. That means, that the neighbor list contains reachable neighbors which have joined the TSCH network and can send EBs on the proper cells.</p>
<dl class="section author"><dt>Author</dt><dd>Georgios Exarchakos <a href="#" onclick="location.href='mai'+'lto:'+'g.e'+'xa'+'rch'+'ak'+'os@'+'tu'+'e.n'+'l'; return false;">g.exa<span style="display: none;">.nosp@m.</span>rcha<span style="display: none;">.nosp@m.</span>kos@t<span style="display: none;">.nosp@m.</span>ue.n<span style="display: none;">.nosp@m.</span>l</a> </dd>
<dd>
Ilker Oztelcan <a href="#" onclick="location.href='mai'+'lto:'+'i.o'+'zt'+'elc'+'an'+'@tu'+'e.'+'nl'; return false;">i.ozt<span style="display: none;">.nosp@m.</span>elca<span style="display: none;">.nosp@m.</span>n@tue<span style="display: none;">.nosp@m.</span>.nl</a> </dd>
<dd>
Dimitris Sarakiotis <a href="#" onclick="location.href='mai'+'lto:'+'d.s'+'ar'+'aki'+'ot'+'is@'+'tu'+'e.n'+'l'; return false;">d.sar<span style="display: none;">.nosp@m.</span>akio<span style="display: none;">.nosp@m.</span>tis@t<span style="display: none;">.nosp@m.</span>ue.n<span style="display: none;">.nosp@m.</span>l</a> </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a0fd35e5dd4046a373e55bc53c6b6d241"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void aggregate_statistics </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>metric</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">plexi_stats_value_st&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Aggregates statistics metric values per link for each neighbor. </p>
<p>Statistics maintained for every link with a neighbor are aggregated by this function. Values for the same metric update an exponential window moving average that will represent the value of that metric for a specific neighbor. However, NEIGHBOR_ASN_LABEL represents the latest communication received by the neighbor. Hence, EWMA is not applicable. Instead, the function replaces the old value with a newer one. The neighbor is detected via the statistics metrics identifier. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>statistics metric identifier (see YANG model <a href="https://tools.ietf.org/html/draft-ietf-6tisch-6top-interface-04">6TiSCH Operation Sublayer (6top) Interface</a> and <a class="el" href="plexi-link-statistics_8h.html">plexi-link-statistics.h</a>) </td></tr>
    <tr><td class="paramname">metric</td><td>the metric the values of which will be aggregated (see <a class="el" href="plexi-interface_8h.html#abc19ec1e399fa30e17dc022fcfcc84ed">STATS_ETX_LABEL</a>, <a class="el" href="plexi-interface_8h.html#af213b3a7b2695c09e94cd7a482d8eb00">STATS_PDR_LABEL</a>, <a class="el" href="plexi-interface_8h.html#ab0149d8e28062120c0f8038e53a22e5a">STATS_RSSI_LABEL</a>, <a class="el" href="plexi-interface_8h.html#a797f4958edbdb06799f4db219d573cfc">STATS_LQI_LABEL</a>, <a class="el" href="plexi-interface_8h.html#ab17d486383822f20e3c45a24eeb892cf">NEIGHBORS_ASN_LABEL</a>) </td></tr>
    <tr><td class="paramname">value</td><td>the value to be aggregated with previous values on the same metric on the same neighbor</td></tr>
  </table>
  </dd>
</dl>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000002">Bug:</a></b></dt><dd>could metric be also retrieved by the statistics metric identifier? </dd></dl>

</div>
</div>
<a class="anchor" id="ad1c9748facc2b23c010bad9d018e74b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PARENT_PERIODIC_RESOURCE </td>
          <td>(</td>
          <td class="paramtype">resource_6top_nbrs&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&quot;obs;&#160;</td>
          <td class="paramname"><em>title</em> = <code>\&quot;6top&#160;neighbours\&quot;&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="plexi-neighbors_8c.html#aabee038a9ed6f8a665aa76463fe9674d">plexi_get_neighbors_handler</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NULL&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NULL&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">NULL&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="plexi-neighbors_8h.html#a72f8e3e31d15df239e8e8b6ffc28dfb9">PLEXI_NEIGHBOR_UPDATE_INTERVAL</a>&#160;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="plexi-neighbors_8c.html#ae6b65a94141537f5ec3cec4efedc6710">plexi_neighbors_event_handler</a>&#160;</td>
          <td class="paramname">&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Neighbor List resource to GET and OBSERVE list of neighbors. Subscribers to this resource are notified of changes and periodically. </p>
<p>Neighbor list is a read only resource and consists of neihbor objects. A neighbor, at its basic structure, is a json object containing one key-value pair: the key <a class="el" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a> and its paired EUI-64 address in string format. Multiple neighbors are represented by multiple json objects in that array. For example: </p>
<div class="fragment"><div class="line">[ {<a class="code" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a>: <span class="stringliteral">&quot;215:8d00:57:6466&quot;</span>}, {<a class="code" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a>: <span class="stringliteral">&quot;215:8d00:57:64a2&quot;</span>} ] </div>
</div><!-- fragment --><p> The neighbor list object is addressed via the URL set in <a class="el" href="plexi-interface_8h.html#ae7ee8b34ab5445c88a1e2eaf327e7f2f">NEIGHBORS_RESOURCE</a> within <a class="el" href="plexi-interface_8h.html">plexi-interface.h</a>. Besides the <a class="el" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a> subresource, each neighbor may contain extra subresources iff statistics are calculated for that neighbor. The statistics-related subresources are: <a class="el" href="plexi-interface_8h.html#abc19ec1e399fa30e17dc022fcfcc84ed">STATS_ETX_LABEL</a>, <a class="el" href="plexi-interface_8h.html#ab0149d8e28062120c0f8038e53a22e5a">STATS_RSSI_LABEL</a>, <a class="el" href="plexi-interface_8h.html#a797f4958edbdb06799f4db219d573cfc">STATS_LQI_LABEL</a>, <a class="el" href="plexi-interface_8h.html#af213b3a7b2695c09e94cd7a482d8eb00">STATS_PDR_LABEL</a>. The switch that (de)activates statistics module is the <a class="el" href="plexi-conf_8h.html#a3a7756007b9da9760ac1a0b28e2ce568">PLEXI_WITH_LINK_STATISTICS</a>. Eanbling statistics module is not sufficient to also enable those subresources in a neighbor object. Recall that statistics are maintained per link, not per neighbor. Hence, to retrieve aggregated statistics per neighbor, links with the specific neighbor have to be configured to maintain statistics. </p>
<dl class="section note"><dt>Note</dt><dd>Due to preprocessor commands the documentation of the PARENT_EVENT_RESOURCE does not show up. Two different types of resources are implemented based on whether the neighbor list is periodically (PARENT_PERIODIC_RESOURCE) or event-based (PARENT_EVENT_RESOURCE) observable. Check the code. </dd></dl>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="plexi-link-statistics_8h.html">plexi-link-statistics.h</a>, <a class="el" href="plexi-link-statistics_8c.html">plexi-link-statistics.c</a>, <a class="el" href="plexi-neighbors_8c.html#ad1c9748facc2b23c010bad9d018e74b7" title="Neighbor List resource to GET and OBSERVE list of neighbors. Subscribers to this resource are notifie...">PARENT_PERIODIC_RESOURCE</a> </dd></dl>

</div>
</div>
<a class="anchor" id="aabee038a9ed6f8a665aa76463fe9674d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void plexi_get_neighbors_handler </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>response</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>preferred_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32_t *&#160;</td>
          <td class="paramname"><em>offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves the list of neighbors upon a CoAP GET request to neighbor list resource. </p>
<p>The handler reacts to requests on the following URLs:</p>
<ul>
<li>base returning a json array of the complete list of neighbor json objects<ul>
<li>if <a class="el" href="plexi-conf_8h.html#a3a7756007b9da9760ac1a0b28e2ce568">PLEXI_WITH_LINK_STATISTICS</a> is not set:<div class="fragment"><div class="line">GET /<a class="code" href="plexi-interface_8h.html#ae7ee8b34ab5445c88a1e2eaf327e7f2f">NEIGHBORS_RESOURCE</a> -&gt; e.g. [ {<a class="code" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a>: <span class="stringliteral">&quot;215:8d00:57:6466&quot;</span>}, {<a class="code" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a>: <span class="stringliteral">&quot;215:8d00:57:64a2&quot;</span>} ] </div>
</div><!-- fragment --></li>
<li>else if <a class="el" href="plexi-conf_8h.html#a3a7756007b9da9760ac1a0b28e2ce568">PLEXI_WITH_LINK_STATISTICS</a> is set:<div class="fragment"><div class="line">GET /<a class="code" href="plexi-interface_8h.html#ae7ee8b34ab5445c88a1e2eaf327e7f2f">NEIGHBORS_RESOURCE</a> -&gt; e.g. [ {<a class="code" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a>: <span class="stringliteral">&quot;215:8d00:57:6466&quot;</span>,<a class="code" href="plexi-interface_8h.html#af213b3a7b2695c09e94cd7a482d8eb00">STATS_PDR_LABEL</a>:89}, {<a class="code" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a>: <span class="stringliteral">&quot;215:8d00:57:64a2&quot;</span>,<a class="code" href="plexi-interface_8h.html#abc19ec1e399fa30e17dc022fcfcc84ed">STATS_ETX_LABEL</a>:2,<a class="code" href="plexi-interface_8h.html#ab0149d8e28062120c0f8038e53a22e5a">STATS_RSSI_LABEL</a>:-50} ] </div>
</div><!-- fragment --> Note that each neighbor may have different metrics according to the statistics configuration installed in each link with that neighbor. All of the following are possible: <a class="el" href="plexi-interface_8h.html#abc19ec1e399fa30e17dc022fcfcc84ed">STATS_ETX_LABEL</a>, <a class="el" href="plexi-interface_8h.html#af213b3a7b2695c09e94cd7a482d8eb00">STATS_PDR_LABEL</a>, <a class="el" href="plexi-interface_8h.html#ab0149d8e28062120c0f8038e53a22e5a">STATS_RSSI_LABEL</a>, <a class="el" href="plexi-interface_8h.html#a797f4958edbdb06799f4db219d573cfc">STATS_LQI_LABEL</a>, <a class="el" href="plexi-interface_8h.html#ab17d486383822f20e3c45a24eeb892cf">NEIGHBORS_ASN_LABEL</a>.</li>
</ul>
</li>
<li>subresources returning json arrays with the values of the specified subresource for all neighbors:<ul>
<li><div class="fragment"><div class="line">GET /<a class="code" href="plexi-interface_8h.html#ae7ee8b34ab5445c88a1e2eaf327e7f2f">NEIGHBORS_RESOURCE</a>/<a class="code" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a> -&gt; a json array of EUI-64 IP addresses (one per neighbor) e.g. [<span class="stringliteral">&quot;215:8d00:57:6466&quot;</span>,<span class="stringliteral">&quot;215:8d00:57:64a2&quot;</span>] </div>
</div><!-- fragment --></li>
<li>if <a class="el" href="plexi-conf_8h.html#a3a7756007b9da9760ac1a0b28e2ce568">PLEXI_WITH_LINK_STATISTICS</a> is set:<div class="fragment"><div class="line">GET /<a class="code" href="plexi-interface_8h.html#ae7ee8b34ab5445c88a1e2eaf327e7f2f">NEIGHBORS_RESOURCE</a>/<a class="code" href="plexi-interface_8h.html#ab0149d8e28062120c0f8038e53a22e5a">STATS_RSSI_LABEL</a> -&gt; a json array of slotframe RSSI values per neighbor e.g. [-50] </div>
</div><!-- fragment --> Note, that any of the available metrics might by a subresource in the URL.</li>
</ul>
</li>
<li>queries on neighbor attributes returning the complete neighbor objects specified by the queries. Neihbors can be queried only by NEGIHBORS_TNA_LABEL. It returns one neighbor object that fulfills the query:<ul>
<li><div class="fragment"><div class="line">GET /<a class="code" href="plexi-interface_8h.html#ae7ee8b34ab5445c88a1e2eaf327e7f2f">NEIGHBORS_RESOURCE</a>?<a class="code" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a>=215:8d00:57:6466 -&gt; a json neighbor <span class="keywordtype">object</span> with specific address e.g.</div>
<div class="line">   <span class="keywordflow">if</span> <a class="code" href="plexi-conf_8h.html#a3a7756007b9da9760ac1a0b28e2ce568">PLEXI_WITH_LINK_STATISTICS</a> not set, then <span class="keywordflow">return</span></div>
<div class="line">       {<a class="code" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a>: <span class="stringliteral">&quot;215:8d00:57:6466&quot;</span>}</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> <a class="code" href="plexi-conf_8h.html#a3a7756007b9da9760ac1a0b28e2ce568">PLEXI_WITH_LINK_STATISTICS</a> is set, then <span class="keywordflow">return</span></div>
<div class="line">       {<a class="code" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a>: <span class="stringliteral">&quot;215:8d00:57:6466&quot;</span>,<a class="code" href="plexi-interface_8h.html#af213b3a7b2695c09e94cd7a482d8eb00">STATS_PDR_LABEL</a>:89}</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>subresource and query. As expected, querying neighbors based on their <a class="el" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a> and rendering one only subresource of the selected neighbors, returns an array of subresource values. E.g.<ul>
<li><div class="fragment"><div class="line">GET /<a class="code" href="plexi-interface_8h.html#ae7ee8b34ab5445c88a1e2eaf327e7f2f">NEIGHBORS_RESOURCE</a>/PDR?<a class="code" href="plexi-interface_8h.html#ab844a0f8e160ed04cb03867f8e72e7bb">NEIGHBORS_TNA_LABEL</a>=215:8d00:57:6466 -&gt; a json array of PDR values from the selected neighbor</div>
<div class="line">   <span class="keywordflow">if</span> <a class="code" href="plexi-conf_8h.html#a3a7756007b9da9760ac1a0b28e2ce568">PLEXI_WITH_LINK_STATISTICS</a> not set, then <span class="keywordflow">return</span> []</div>
<div class="line">   <span class="keywordflow">else</span> <span class="keywordflow">if</span> <a class="code" href="plexi-conf_8h.html#a3a7756007b9da9760ac1a0b28e2ce568">PLEXI_WITH_LINK_STATISTICS</a> is set, then <span class="keywordflow">return</span> [89]</div>
</div><!-- fragment --></li>
</ul>
</li>
</ul>
<dl class="section see"><dt>See Also</dt><dd>apps/rest-engine/rest-engine.h for more information on the handler signatures </dd></dl>

</div>
</div>
<a class="anchor" id="ae6b65a94141537f5ec3cec4efedc6710"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void plexi_neighbors_event_handler </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Notifies subscribers to neighbor list of any changes in the neighbor list. </p>
<p>Notifies periodically all clients who observe the neighbor list resource.</p>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000001">Bug:</a></b></dt><dd>The implementation does not guarantee detection of node removal or rewiring. Avoid relying on uip_ds6_nbr </dd></dl>

</div>
</div>
<a class="anchor" id="a9c25592b86fa9e457f00d0fc05dfd823"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void plexi_neighbors_init </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Landing initialization function of plexi-neighbors module. Call from <a class="el" href="plexi_8h.html#a146916d944fd1adb5c0621bbf4ded47b">plexi_init</a> to start plexi-neighbors module. </p>
<p>Registers neighbor list resource to be exposed over CoAP. The resource allows for GET only command. The neighbor list is an observable resource notifying subscribers periodically and on change of the neighbor list.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="plexi_8h.html#a146916d944fd1adb5c0621bbf4ded47b" title="Landing initialization function of plexi. Call from application to start plexi. ">plexi_init</a> </dd></dl>

</div>
</div>
<a class="anchor" id="a7e4c102e8532799c7a9e9c34c745c502"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void route_changed_callback </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>event</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uip_ipaddr_t *&#160;</td>
          <td class="paramname"><em>route</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uip_ipaddr_t *&#160;</td>
          <td class="paramname"><em>ipaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_routes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback function to be called when a change to the DAG_RESOURCE resource has occurred. Any change is delayed 30seconds before it is propagated to the observers. </p>
<dl class="bug"><dt><b><a class="el" href="bug.html#_bug000003">Bug:</a></b></dt><dd>UIP+DS6_NOTIFICATION_* do not provide a reliable way to listen to events </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="a261a160bd3be8f85d6d73d664de14656"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structaggregate__stats__struct.html">aggregate_stats_struct</a> temp_aggregate_stats = { .rssi = (int)0xFFFFFFFFFFFFFFFF, .lqi = -1, .etx = -1, .pdr = -1, .asn = -1, .rssi_counter = 0, .lqi_counter = 0, .asn_counter = 0, .etx_counter = 0, .pdr_counter = 0 }</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Α module-scope temporary structure to keep track of help the aggregation of the link-oriented statistics into neighbor-wide statistics. </p>
<p>Structure populated by <a class="el" href="plexi-neighbors_8c.html#a0fd35e5dd4046a373e55bc53c6b6d241">aggregate_statistics</a>. Its lifetime is a single execution of <a class="el" href="plexi-neighbors_8c.html#aabee038a9ed6f8a665aa76463fe9674d">plexi_get_neighbors_handler</a>. Once <a class="el" href="plexi-neighbors_8c.html#aabee038a9ed6f8a665aa76463fe9674d">plexi_get_neighbors_handler</a> is called again, the structure is re-initialized. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Mar 2 2016 12:18:57 for plexi by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
